{% extends "base.html" %}

{% block title %}Admin Dashboard - QuizFlow{% endblock %}

{% block content %}
<div class="page-header">
    <h1>‚öôÔ∏è Admin Dashboard</h1>
    <div class="header-actions">
        {% if unread_count > 0 %}
        <a href="{{ url_for('admin.messages') }}" class="btn btn-primary">
            üìß Messages <span class="badge">{{ unread_count }}</span>
        </a>
        {% else %}
        <a href="{{ url_for('admin.messages') }}" class="btn btn-secondary">üìß Messages</a>
        {% endif %}
        <a href="{{ url_for('admin.logout') }}" class="btn btn-danger">Logout</a>
    </div>
</div>

<div class="admin-section">
    <h2>üì§ Upload New Quiz</h2>
    <form method="POST" action="{{ url_for('admin.upload') }}" class="upload-form">
        <div class="form-row">
            <div class="form-group">
                <label for="title">Quiz Title *</label>
                <input type="text" id="title" name="title" required placeholder="e.g., JavaScript Basics">
            </div>
            
            <div class="form-group">
                <label for="timer_minutes">Timer (minutes) *</label>
                <input type="number" id="timer_minutes" name="timer_minutes" value="30" min="1" max="180" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="format">Format *</label>
            <select id="format" name="format">
                <option value="yaml">YAML</option>
                <option value="gift">GIFT</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="content">Quiz Content *</label>
            <textarea id="content" name="content" rows="15" required placeholder="Paste your YAML or GIFT format questions here..."></textarea>
        </div>
        
        <button type="submit" class="btn btn-success btn-block">üì§ Upload Quiz</button>
    </form>
</div>

<div class="admin-section">
    <h2>üìö Existing Quizzes ({{ quizzes|length }})</h2>
    {% if quizzes %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Questions</th>
                    <th>Timer</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for quiz in quizzes %}
                <tr>
                    <td><strong>{{ quiz.title }}</strong></td>
                    <td>{{ quiz.questions|length }}</td>
                    <td>{{ quiz.timer_minutes }} min</td>
                    <td>{{ quiz.created_at[:10] }}</td>
                    <td>
                        <a href="{{ url_for('quiz.start', quiz_id=quiz.id) }}" class="btn btn-sm btn-primary">Preview</a>
                        <form method="POST" action="{{ url_for('admin.delete', quiz_id=quiz.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this quiz and all its results?')">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <p>No quizzes yet. Upload one above!</p>
    </div>
    {% endif %}
</div>

<div class="admin-section">
    <h2>üìä Recent Results ({{ results|length }})</h2>
    {% if results %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Quiz</th>
                    <th>Score</th>
                    <th>Percentage</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{ result.quiz_title }}</td>
                    <td>{{ result.score }} / {{ result.total }}</td>
                    <td class="{% if result.percentage >= 70 %}text-success{% else %}text-danger{% endif %}">
                        {{ result.percentage }}%
                    </td>
                    <td>{{ result.taken_at[:16] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üìä</div>
        <p>No results yet.</p>
    </div>
    {% endif %}
</div>

<div class="help-section">
    <h3>üìù Format Examples</h3>
    <details>
        <summary>YAML Format</summary>
        <pre>- question: "What is 2 + 2?"
  options:
    - "3"
    - "4"
    - "5"
  correct: 1

- question: "Code example:\n```python\nprint('Hello')\n```\nWhat does this print?"
  options:
    - "Hello"
    - "World"
  correct: 0</pre>
    </details>
    
    <details>
        <summary>GIFT Format</summary>
        <pre>::Q1:: What is 2 + 2?{
=4
~3
~5
}

::Q2:: Code example:\n```python\nprint('Hello')\n```\nWhat does this print?{
=Hello
~World
}</pre>
    </details>
</div>

<style>
.badge {
    display: inline-block;
    background: var(--danger);
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}
</style>
{% endblock %}